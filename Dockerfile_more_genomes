# Dockerfile for MutantHuntWGS pipeline
# Coded by Jen Walker and edited by Mitch Ellison

FROM ubuntu:latest

WORKDIR /Main



# remove interactive dialogue with debian front end during automated build

ENV DEBIAN_FRONTEND=noninteractive



# We need to get the basic bash commands we need

RUN apt-get -qq update && \
	apt-get -qq -y install apt-utils && \
	apt-get -qq -y install wget unzip bzip2 gcc git libncurses5-dev zlib1g-dev make python g++ libtbb-dev pkg-config default-jre



# Install MutantHuntWGS

RUN git clone https://github.com/mae92/MutantHuntWGS.git

RUN echo 'export PATH="/Main/MutantHuntWGS/Code:$PATH"' >> ~/.bashrc

RUN chmod 777 /Main/MutantHuntWGS/Code/MutantHuntWGS.sh




# Install bowtie2 (currently master, might want to grab 2.2.9)

RUN wget https://sourceforge.net/projects/bowtie-bio/files/bowtie2/2.2.9/bowtie2-2.2.9-linux-x86_64.zip/download && \
    unzip ./download && \
    cd ./bowtie2-2.2.9 && \
#    make && \
    cd ../

RUN echo 'export PATH="/Main/bowtie2-2.2.9:$PATH"' >> ~/.bashrc



# Install samtools 1.3.1

RUN wget https://github.com/samtools/samtools/releases/download/1.3.1/samtools-1.3.1.tar.bz2 && \
    tar -jxf ./samtools-1.3.1.tar.bz2 && \
    cd samtools-1.3.1 && \
    ./configure && \
    make install && \
    cd ../



# Install bcftools 1.3.1

RUN wget https://github.com/samtools/bcftools/releases/download/1.3/bcftools-1.3.tar.bz2 && \
    tar -jxf ./bcftools-1.3.tar.bz2 && \
    cd bcftools-1.3 && \
    make && \
    cd ../

RUN echo 'export PATH="/Main/bcftools-1.3:$PATH"' >> ~/.bashrc



# Install vcftools 0.1.14

RUN wget https://github.com/vcftools/vcftools/releases/download/v0.1.14/vcftools-0.1.14.tar.gz && \
    tar -zxf ./vcftools-0.1.14.tar.gz && \
    cd vcftools-0.1.14 && \
    ./configure && \
    make && \
    make install && \
    cd ../



# Install snpEff 4.3p

RUN wget http://sourceforge.net/projects/snpeff/files/snpEff_v4_3p_core.zip && \
    unzip ./snpEff_v4_3p_core.zip

RUN echo 'export PATH="/Main/snpEff/scripts:$PATH"' >> ~/.bashrc

RUN /Main/snpEff/scripts/snpEff ann -v Saccharomyces_cerevisiae



# Install SIFT4G annotator

RUN wget https://github.com/pauline-ng/SIFT4G_Annotator/raw/master/SIFT4G_Annotator.jar

RUN echo 'export PATH="/Main/SIFT4G_Annotator.jar:$PATH"' >> ~/.bashrc


# Install S. cerevisiae genome files

RUN wget https://sift.bii.a-star.edu.sg/sift4g/public//Saccharomyces_cerevisiae/R64-1-1.23.zip && \
	unzip ./R64-1-1.23.zip 


# Install S. pombe genome files

RUN wget https://sift.bii.a-star.edu.sg/sift4g/public//Schizosaccharomyces_pombe/ASM294v2.22.zip && \
	unzip ./ASM294v2.22.zip


# Install A. thaliana genome files

RUN wget https://sift.bii.a-star.edu.sg/sift4g/public//Arabidopsis_thaliana/TAIR10.23.zip && \
	unzip ./TAIR10.23.zip
	

# Install C. elegans genome files

RUN wget https://sift.bii.a-star.edu.sg/sift4g/public//Caenorhabditis_elegans/WBcel235.83.zip && \
	unzip ./WBcel235.83.zip


# Install D. melanogaster genome files

RUN wget https://sift.bii.a-star.edu.sg/sift4g/public//Drosophila_melanogaster/BDGP6.83.zip && \
	unzip ./BDGP6.83.zip


# Install D. rerio genome files

RUN wget https://sift.bii.a-star.edu.sg/sift4g/public//Danio_rerio/GRCz10.83.zip && \
	unzip ./GRCz10.83.zip


# Install M. muculus genome files

RUN wget https://sift.bii.a-star.edu.sg/sift4g/public//Mus_musculus/GRCm38.83.zip && \
	unzip ./GRCm38.83.zip 



ADD . .

RUN apt-get -qq -y install emacs



